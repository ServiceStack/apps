<html>
<head>
<title>Instant Client Apps</title>
<meta charset="UTF-8">
<meta name="copyright" content="Copyright 2020. ServiceStack, Inc">
<link rel="icon" type="image/svg+xml" href="/assets/img/logo.svg">
<link rel="stylesheet" href="/assets/css/litewind.css">
<style>
a { color: #007bff }
.container { }
.w-section,.w-container {width:900px}
.w-wide-section { width: 1200px }
.w-wide-section-half { width: 600px }
.h-embed{height:700px}.m-t-embed{margin-top:-700px}
.invalid-feedback::before{content:"\2718"}
.is-invalid::after{content:"\2718"}

.hide-enabled,.loading,.show-loading,.show-error,.show-meta,.show-embed,.show-auth,.show-fullscreen,.modal {display:none}
.has-error .hide-error{display:none !important}

.nourl .hide-enabled{display:block}
.show-enabled{display:block}
.nourl .show-enabled{display:none}
.has-error .show-error{display:block}
.requires-auth .show-auth{display:block}
.loading .show-loading{display:block}
.loading .show-loading.flex{display:flex}
.loading .hide-loading{display:none}
.has-embed .show-embed{display:block}
.has-meta .show-meta{display:block}

.fullscreen .hide-fullscreen {display:none}
.fullscreen .show-fullscreen {display:block}
.fullscreen .max-fullscreen {width:100%;max-width:unset}
.fullscreen #btn-clear,.fullscreen .btn-help {position:absolute;right:125px}
.fullscreen #formUrl {margin:0}
.fullscreen #customize-embed {padding:0 .5rem}
.modal.active {display:block}

[data-use] { display: none; cursor: pointer }
.csharp .show-csharp,.typescript .show-typescript,.python .show-python,.dart .show-dart,.java .show-java,.kotlin .show-kotlin,.swift .show-swift,.vbnet .show-vbnet,.fsharp .show-fsharp
{ display: flex }

.nourl .lang {filter:grayscale(100%);opacity:.5;box-shadow:none;cursor:default}
.lang img {transform:scale(.90)}
.lang:hover {background-color:#fff}
.lang:active, .lang.active, .tag.active {
    background-color: #fff;
    --tw-shadow: inset 0 1px 2px 0 rgba(0,0,0,0.16);box-shadow:var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow);
}
INPUT.text-3xl { line-height: 2.5rem }
#choose-api .awesomplete { width: 100%; }
#apiForm .awesomplete { display: block }
#apiForm .awesomplete ul { overflow-y: auto; max-height: 19.5rem; }
#apiForm .awesomplete ul::-webkit-scrollbar { width:5px; height:8px; }
#apiForm .awesomplete ul::-webkit-scrollbar-thumb { background-color: #e0e0e0; }

[data-tab].active { background: #F4F5F7; color: #1f2937; }
.tab-pane { display: none; }
.tab-pane.active { display: block; }
em { font-family: monospace; font-style: normal; font-size: 120%; color: #05930c; }
.sm em { font-size: 100%; }
i.svg-copy { display: inline-block; vertical-align: middle;
    background-image: url("data:image/svg+xml,%3Csvg fill='none' stroke='currentColor' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7v8a2 2 0 002 2h6M8 7V5a2 2 0 012-2h4.586a1 1 0 01.707.293l4.414 4.414a1 1 0 01.293.707V15a2 2 0 01-2 2h-2M8 7H6a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-2'%3E%3C/path%3E%3C/svg%3E");
}
pre.sh { background: #eee; border-radius: 5px; margin: 1rem 0; padding: .5rem 1rem; }
pre label { overflow: hidden; text-overflow: ellipsis; }
pre.sh::before { content: "$ "; }
pre.copy { display: flex; padding-right: .5rem; }
pre.copy label { flex: 1 1 auto; padding-right: 1rem; }
pre.copy b { display: none; font-size: 12px; color: #888; padding-right:.25rem; font-weight:normal; }
pre.copy b::before { content: "copied" }
pre.copy div { flex: 1 1 auto; text-align: right; }
pre.copy i { cursor:pointer; height:24px; width:24px; opacity: .8; }
pre.copy i:hover { opacity: .6; }
pre.copied b { display: inline-block; }
pre.copied i { opacity: .4; }

.cmd pre { max-width:550px }
.fullscreen .cmd pre { margin: -10px 0 0 0 }
.fullscreen .cmd pre { position: absolute; max-width:46% }
.fullscreen .cmd p { margin: 0 0 30px 0 }

.full-cmd pre { max-width:1200px }
.fullscreen .full-cmd { padding:.5% }
.fullscreen .full-cmd pre { max-width:99%; }

#lnkEmbed { margin: .5rem 0 0 75.5rem }
#lnkEmbed span { visibility: hidden }
#lnkEmbed:hover span { visibility: visible }

@media (min-width: 414px) {
    .just-add { display:none }
    .w-25{width:3.125rem}.h-25{height:3.125rem}
    .text-3xl{font-size: 1rem;line-height: 1.5rem}
    .text-6xl { font-size: 1.875rem }
    .w-section,.w-container { width: 414px }
    .video-hd { width: 414px; height: 233px }
}
@media (min-width: 768px) {
    .just-add { display:block }
    .w-25{width:6.25rem}.h-25{height:6.25rem}
    .text-3xl { font-size: 1.875rem;line-height: 2.25rem }
    .text-6xl { font-size: 3.75rem;line-height: 1 }
    .w-section,.w-container { width: 768px }
    .video-hd { width: 768px; height: 432px }
}
@media (min-width: 1024px) {
    .video-hd { width: 896px; height: 504px }
}
@media only screen and (min-width:900px) {
    .w-section,.w-container { width: 900px }
}
</style>

<script>let exports = { __esModule:true }, module = { exports:exports }; function require(name) { return exports[name] || window[name] }</script>
<script defer src="/assets/js/servicestack-client.js"></script>
<script defer src="/assets/js/dtos.js"></script>
<script src="https://apis.google.com/js/platform.js" async defer></script>
</head>
<body class="m-0 font-sans bg-gray-50 nourl">
<i hidden>{{ '/js/hot-fileloader.js' |> ifDebugIncludeScript }}</i>

<div class="container mx-auto flex flex-col place-items-center max-fullscreen">
    <h1 class="mt-4 mb-1 text-6xl font-semibold text-center text-gray-700 hide-fullscreen"><a href="./" class="text-gray-700">Instant Client Apps</a></h1>
    <small class="just-add mt-1 mb-2 text-base text-gray-400 hide-fullscreen">just add</small>

    <form id="formUrl" class="max-fullscreen">
        <div class="w-section flex justify-between max-fullscreen">
            <select id="scheme" class="border rounded-none py-2 px-3 text-grey-900 text-3xl shadow bg-none w-auto">
                <option value="https">https://</option>
                <option value="http">http://</option>
            </select>
            <input id="baseUrl" class="flex-grow border rounded-none py-2 px-3 text-grey-900 text-3xl shadow" type="text" placeholder="ServiceStack Base URL">
            <select id="selLang" class="show-fullscreen border rounded-none py-2 px-3 text-grey-900 text-3xl shadow bg-none" style="max-width:125px">
                <option value="csharp">C#</option>
                <option value="typescript">Node.js</option>
                <option value="python">Python</option>
                <option value="dart">Dart</option>
                <option value="java">Java</option>
                <option value="kotlin">Kotlin</option>
                <option value="swift">Swift</option>
                <option value="vbnet">VB</option>
                <option value="fsharp">F#</option>
            </select>
        </div>
        <div id="btn-clear" class="show-enabled absolute text-right w-section">
            <div title="clear" class="float-right w-6 text-2xl text-gray-500 cursor-pointer" style="margin:-2.85rem 1rem 0 0">&#10005;</div>
        </div>
        <div class="btn-help hide-enabled absolute text-right w-section">
            <a  href="https://docs.servicestack.net/create-your-first-webservice"
                title="Create ServiceStack APIs" class="float-right w-6 text-2xl text-gray-500 cursor-pointer" style="margin:-2.85rem 1rem 0 0">&quest;</a>
        </div>

        <div class="text-center">
            <div class="error-summary invalid-feedback my-1"></div>
            <small class="text-base text-gray-400 hide-fullscreen">
                try <a href="#techstacks.io">techstacks.io</a>,
                <a href="#chinook.netcore.io">chinook</a>,
                <a href="#northwind.netcore.io">northwind</a>,
                <a href="#covid-vac-watch.netcore.io">vaccines-watch</a>
            </small>
        </div>
    </form>

    <div class="flex justify-evenly langs m-4 pb-6 w-container hide-fullscreen">
        <span data-lang="csharp" class="lang project shadow-lg rounded-full cursor-pointer" title="C#" data-click="selectLang">
            <img class="w-20 h-20" src="/assets/img/csharp.svg" alt="C# logo">
        </span>

        <span data-lang="typescript" class="lang project shadow-lg rounded-full cursor-pointer" title="Node.js TypeScript" data-click="selectLang">
            <img class="w-20 h-20" src="/assets/img/typescript.svg" alt="Node.js logo">
        </span>

        <span data-lang="python" class="lang project shadow-lg rounded-full cursor-pointer" title="Python" data-click="selectLang">
            <img class="w-20 h-20" src="/assets/img/python.svg" alt="Python logo">
        </span>

        <span data-lang="dart" class="lang shadow-lg rounded-full cursor-pointer" title="Dart" data-click="selectLang">
            <img class="w-20 h-20" src="/assets/img/dart.svg" alt="Dart logo">
        </span>

        <span data-lang="java" class="lang shadow-lg rounded-full cursor-pointer" title="Java" data-click="selectLang">
            <img class="w-20 h-20" src="/assets/img/java.svg" alt="Java logo">
        </span>

        <span data-lang="kotlin" class="lang shadow-lg rounded-full cursor-pointer" title="Kotlin" data-click="selectLang">
            <img class="w-20 h-20" src="/assets/img/kotlin.svg" alt="Kotlin logo">
        </span>

        <span data-lang="swift" class="lang shadow-lg rounded-full cursor-pointer" title="Swift" data-click="selectLang">
            <img class="w-20 h-20" src="/assets/img/swift.svg" alt="Swift logo">
        </span>

        <span data-lang="vbnet" class="lang project shadow-lg rounded-full cursor-pointer" title="VB" data-click="selectLang">
            <img class="w-20 h-20" src="/assets/img/vb.svg" alt="VB.NET logo">
        </span>

        <span data-lang="fsharp" class="lang shadow-lg rounded-full cursor-pointer" title="F#" data-click="selectLang">
            <img class="w-20 h-20" src="/assets/img/fsharp.svg" alt="F# logo">
        </span>
    </div>
    
    <div class="hide-enabled text-xl gray-500 mt-2">
        <p>
            Services built using <a href="https://servicestack.net">ServiceStack</a> can generate instant Client Apps for all
            <a href="https://docs.servicestack.net/add-servicestack-reference">supported languages</a> above.
        </p>
        <p>
            <a href="https://docs.servicestack.net/clients-overview">Generic Service Clients</a>
            use the native language DTOs to enable its productive end-to-end typed APIs.
        </p>
        <div class="pt-8">
            <iframe class="video-hd" src="https://www.youtube.com/embed/GTnuMhvUayg" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
        </div>
    </div>

    <div id="error-summary" class="show-error w-section mt-8 bg-red-100 border-l-4 border-red-300 text-red-dark p-4" role="alert">
        <b></b>
        <p></p>
    </div>

    <div class="show-embed hide-error max-fullscreen">
        <div id="embed" class="hide-loading w-wide-section shadow h-embed max-fullscreen"></div>
        <div id="embed-loading" class="show-loading w-wide-section h-embed flex place-items-center bg-white shadow max-fullscreen">
            <div class="w-wide-section text-center text-2xl flex justify-center max-fullscreen">
                Loading
                <img class="w-8 h-8 pl-1 pt-1" src="/assets/img/loading.svg" alt="loading...">
            </div>
        </div>
        
        <div id="customize-embed" class="flex">
            <div class="flex-1">
                <div id="tags" class="mt-2 flex" style="min-height:1.5rem"></div>
                <label id="choose-api">
                    <input id="txtRequest" type="text" spellcheck="false" placeholder="Choose API"
                           class="flex-grow border rounded-none mt-1 py-2 px-3 text-grey-900 text-3xl">
                    <div id="btn-auth" class="show-auth absolute" style="margin: -2.5rem 0 0 -2.5rem; left:50%; z-index: 1">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-6 h-6">
                            <title>Requires Authentication</title>
                            <path fill="#374151" d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM9 6c0-1.66 1.34-3 3-3s3 1.34 3 3v2H9V6zm9 14H6V10h12v10zm-6-3c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2z"/>
                        </svg>
                    </div>
                </label>
                <div id="apiForm" class="mt-2 w-full"></div>
            </div>
            <div class="flex-shrink px-1"></div>
            <div class="flex-1">
                <div class="mt-2 text-gray-500 font-semibold uppercase text-right">Customize Download</div>
                <label id="customize-download">
                    <input id="txtProjectName" type="text" spellcheck="false" placeholder="ProjectName"
                           onkeypress="return isAlphaNumeric(event.charCode)"
                           onchange="this.value = this.value.replace(/[\W]+/g,'')"
                           oninput="updateDownload()"
                           class="flex-grow border rounded-none mt-1 py-2 px-3 text-grey-900 text-3xl">
                </label>
                <div id="customForm" class="show-meta mt-2 w-full">
                    <div class="shadow overflow-hidden sm:rounded">
                        <div class="px-4 py-5 bg-white sm:p-6">

                            <div id="includeDtos"></div>

                            <h3 class="uppercase my-4 text-base font-medium text-gray-900">Download</h3>
                            <div class="flex justify-center">
                                <a id="zip" href="#">
                                    <svg class="w-12 h-12 inline-block mb-2" xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24" fill="none">
                                        <path fill="currentColor" d="M9.49094 4.40235C9.1153 4.14129 8.66749 4 8.20693 4H4.25L4.09595 4.00519C2.92516 4.08436 2 5.05914 2 6.25V17.75L2.00519 17.904C2.08436 19.0748 3.05914 20 4.25 20H19.75L19.904 19.9948C21.0748 19.9156 22 18.9409 22 17.75V8.75L21.9948 8.59595L21.9785 8.43788C21.8266 7.34297 20.8867 6.5 19.75 6.5H12.022L9.64734 4.5215L9.49094 4.40235ZM13.4967 8V10.2451C13.4967 10.6593 13.8325 10.9951 14.2467 10.9951H14.9967V11.9976H14.7467C14.3325 11.9976 13.9967 12.3334 13.9967 12.7476C13.9967 13.1618 14.3325 13.4976 14.7467 13.4976H14.9967V14.9976H14.7467C14.3325 14.9976 13.9967 15.3334 13.9967 15.7476C13.9967 16.1618 14.3325 16.4976 14.7467 16.4976H14.9967V18.5H4.25L4.14823 18.4932C3.78215 18.4435 3.5 18.1297 3.5 17.75V10.499L8.20693 10.5L8.40335 10.4914C8.85906 10.4515 9.29353 10.2733 9.64734 9.9785L12.021 8H13.4967ZM16.4967 18.0004H16.7467C17.1609 18.0004 17.4967 17.6646 17.4967 17.2504C17.4967 16.8362 17.1609 16.5004 16.7467 16.5004H16.4967V15.0004H16.7467C17.1609 15.0004 17.4967 14.6646 17.4967 14.2504C17.4967 13.8362 17.1609 13.5004 16.7467 13.5004H16.4967V10.9951H17.2467C17.6609 10.9951 17.9967 10.6593 17.9967 10.2451V8H19.75L19.8518 8.00685C20.2178 8.05651 20.5 8.3703 20.5 8.75V17.75L20.4932 17.8518C20.4435 18.2178 20.1297 18.5 19.75 18.5H16.4967V18.0004ZM16.4967 8V9.49513L14.9967 9.49513V8H16.4967ZM4.25 5.5H8.20693L8.31129 5.5073C8.44893 5.52664 8.57923 5.58398 8.68706 5.67383L10.578 7.249L8.68706 8.82617L8.60221 8.88738C8.4841 8.96063 8.34729 9 8.20693 9L3.5 8.999V6.25L3.50685 6.14823C3.55651 5.78215 3.8703 5.5 4.25 5.5Z"/>
                                    </svg><span id="lblProject" class="ml-1 text-2xl inline-block">MyApp</span>
                                </a>
                                <a id="notebook" href="#">
                                    <img class="w-12 h-12 inline-block mb-2 ml-8" src="/assets/img/jupyter.svg" alt="Jupyter Notebook Logo">
                                    <span class="mx-1 text-2xl inline-block">Notebook</span>
                                    <div class="inline-block align-text-bottom"><div id="savetodrive-div"></div></div>
                                </a>
                            </div>

                            <div id="mix" class="cmd">
                                <h3 class="my-4 text-base font-medium text-gray-900">Mix into Directory</h3>
                                <pre class="sh copy flex">
                                    <label class="flex-shrink overflow-hidden"></label>
                                    <b class="flex-shrink-0"></b><i class="svg-copy flex-shrink-0" title="copy" onclick="copy(this)"></i>
                                </pre>
                                <p class="text-sm gray-500">Mix source files into current directory, preserving any existing files.</p>
                            </div>
                            
                            <h3 class="uppercase my-4 text-base font-medium text-gray-900">Open With...</h3>
                            <div id="xopen" class="flex justify-center gap-5">
                                <div data-use="folder" data-click="openWith" class="flex flex-col items-center text-center show-csharp show-typescript show-dart show-java show-kotlin show-swift show-vbnet show-fsharp show-python">
                                    <img class="w-10 h-10" src="/assets/img/folder.svg" alt="Folder Icon">
                                    <span class="text-gray-500">Folder</span>
                                </div>
                                <div data-use="code" data-click="openWith" class="flex flex-col items-center text-center show-csharp show-typescript show-dart show-java show-kotlin show-swift show-vbnet show-fsharp show-python">
                                    <img class="w-10 h-10" src="/assets/img/vscode.svg" alt="VS Code Icon">
                                    <span class="text-gray-500">VS Code</span>
                                </div>
                                <div data-use="rider" data-click="openWith" class="flex flex-col items-center text-center show-csharp show-vbnet">
                                    <img class="w-10 h-10" src="/assets/img/rider.svg" alt="Rider Icon">
                                    <span class="text-gray-500">Rider</span>
                                </div>
                                <div data-use="devenv" data-click="openWith" class="flex flex-col items-center text-center show-csharp show-vbnet show-fsharp">
                                    <img class="w-10 h-10" src="/assets/img/visualstudio.svg" alt="Visual Studio Icon">
                                    <span class="text-gray-500">Visual Studio</span>
                                </div>
                                <div data-use="webstorm" data-click="openWith" class="flex flex-col items-center text-center show-typescript show-dart">
                                    <img class="w-10 h-10" src="/assets/img/webstorm.svg" alt="Visual Studio Icon">
                                    <span class="text-gray-500">WebStorm</span>
                                </div>
                                <div data-use="pycharm" data-click="openWith" class="flex flex-col items-center text-center show-typescript show-python">
                                    <img class="w-10 h-10" src="/assets/img/pycharm.svg" alt="PyCharm Icon">
                                    <span class="text-gray-500">PyCharm</span>
                                </div>
                                <div data-use="studio" data-click="openWith" class="flex flex-col items-center text-center show-dart show-java show-kotlin">
                                    <img class="w-10 h-10" src="/assets/img/androidstudio.svg" alt="Android Studio Icon">
                                    <span class="text-gray-500">Android Studio</span>
                                </div>
                                <div data-use="idea" data-click="openWith" class="flex flex-col items-center text-center show-java show-kotlin">
                                    <img class="w-10 h-10" src="/assets/img/idea.svg" alt="Intellij IDEA Icon">
                                    <span class="text-gray-500">Intellij IDEA</span>
                                </div>
                                <div data-use="xcode" data-click="openWith" class="flex flex-col items-center text-center show-swift">
                                    <img class="w-10 h-10" src="/assets/img/xcode.svg" alt="Xcode Icon">
                                    <span class="text-gray-500">Xcode</span>
                                </div>
                                <div data-use="appcode" data-click="openWith" class="flex flex-col items-center text-center show-swift">
                                    <img class="w-10 h-10" src="/assets/img/appcode.svg" alt="AppCode Icon">
                                    <span class="text-gray-500">App Code</span>
                                </div>
                            </div>

                            <h3 class="uppercase my-4 text-base font-medium text-gray-900">Setup</h3>

                            <div id="setup" class="tabs mt-2 mb-2 flex flex-col" style="min-height:1.5rem">
                                <div class="flex justify-evenly">
                                    <div class="text-base inline-flex items-center leading-4 px-3 py-2 mr-1 text-gray-500 font-semibold rounded-md cursor-pointer"
                                         data-tab="win" data-click="selectTab">Windows</div>
                                    <div class="text-base inline-flex items-center leading-4 px-3 py-2 mr-1 text-gray-500 font-semibold rounded-md cursor-pointer"
                                         data-tab="mac" data-click="selectTab">macOS</div>
                                    <div class="text-base inline-flex items-center leading-4 px-3 py-2 mr-1 text-gray-500 font-semibold rounded-md cursor-pointer"
                                         data-tab="linux" data-click="selectTab">Linux</div>
                                </div>
                                <div class="tab-content pt-4">
                                    <div id="win" class="tab-pane">
                                        <p class="">
                                            1. <a href="https://dotnet.microsoft.com/download">Install .NET 5 SDK</a>
                                        </p>
                                        <p>
                                            2. Use <em>Win+R</em> Shortcut and paste command below to run the
                                            <a href="https://gist.cafe/install.ps1">install.ps1</a> script:
                                        </p>
                                        <pre class="sh copy"><label>powershell iwr gist.cafe/install.ps1 -useb | iex</label><b></b><i class="svg-copy" title="copy" onclick="copy(this)"></i></pre>
                                        <p>
                                            3. Add Applications to <em>%PATH%</em>
                                        </p>
                                        <ul class="list-inside list-disc">
                                            <li>
                                                Configure <a href="https://code.visualstudio.com/docs/setup/windows">VS Code</a>
                                            </li>
                                            <li>
                                                Configure <a href="https://www.jetbrains.com/help/idea/working-with-the-ide-features-from-command-line.html#toolbox">JetBrains IDEs</a>
                                            </li>
                                        </ul>
                                    </div>
                                    <div id="mac" class="tab-pane">
                                        <p class="">
                                            1. <a href="https://dotnet.microsoft.com/download">Install .NET 5 SDK</a>
                                        </p>
                                        <p>
                                            2. Download &amp; open <a href="https://gist.cafe/gist.dmg">gist.dmg</a> then copy the <b>gist</b> app to Applications:
                                            <a href="https://gist.cafe/gist.dmg"><img src="https://gist.cafe/assets/img/install-gist.png" alt="Install gist.dmg" style="max-width:550px"></a>
                                        </p>
                                        <p>
                                            3. Add Applications to <em>$PATH</em>
                                        </p>
                                        <ul class="list-inside list-disc">
                                            <li>
                                                Configure <a href="https://code.visualstudio.com/docs/setup/mac">VS Code</a>
                                            </li>
                                            <li>
                                                Configure <a href="https://www.jetbrains.com/help/idea/working-with-the-ide-features-from-command-line.html#toolbox">JetBrains IDEs</a>
                                            </li>
                                        </ul>
                                    </div>
                                    <div id="linux" class="tab-pane">
                                        <p class="">
                                            1. <a href="https://dotnet.microsoft.com/download">Install .NET 5 SDK</a>
                                        </p>
                                        <p>
                                            2. Run <a href="https://gist.cafe/install.sh">install.sh</a>:
                                        </p>
                                        <pre class="sh copy"><label>wget -qO- https://gist.cafe/install.sh | bash</label><b></b><i class="svg-copy" title="copy" onclick="copy(this)"></i></pre>
                                        <p>
                                            3. Add Applications to <em>$PATH</em>
                                        </p>
                                        <ul class="list-inside list-disc">
                                            <li>
                                                Configure <a href="https://code.visualstudio.com/docs/setup/linux">VS Code</a>
                                            </li>
                                            <li>
                                                Configure <a href="https://www.jetbrains.com/help/idea/working-with-the-ide-features-from-command-line.html#toolbox">JetBrains IDEs</a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="hide-loading show-meta">
            <div id="jupyter" class="cmd full-cmd">
                <h3 class="mb-4 text-base font-medium text-gray-900">
                    Generate Jupyter Notebook
                    <a href="https://docs.servicestack.net/jupyter-notebooks" title="Learn how to use Jupyter Notebooks">
                        <svg class="w-5 h-5 inline-block mb-1"
                             fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    </a>
                </h3>
                <pre class="sh copy flex">
                    <label class="flex-shrink overflow-hidden"></label>
                    <b class="flex-shrink-0"></b><i class="svg-copy flex-shrink-0" title="copy" onclick="copy(this)"></i>
                </pre>
            </div>

            <div id="invoke" class="cmd full-cmd">
                <h3 class="mb-4 text-base font-medium text-gray-900">
                    Invoke API from command line
                    <a href="https://docs.servicestack.net/post-command" title="Learn how to use Post Command">
                        <svg class="w-5 h-5 inline-block mb-1"
                             fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    </a>
                </h3>
                <pre class="sh copy flex">
                    <label class="flex-shrink overflow-hidden"></label>
                    <b class="flex-shrink-0"></b><i class="svg-copy flex-shrink-0" title="copy" onclick="copy(this)"></i>
                </pre>
            </div>
        </div>
        
    </div>
</div>

<div id="embed-modal" class="modal antialiased font-sans bg-gray-200 overflow-hidden"><div>
    <div class="bg-gray-300">
        <div class="fixed z-10 inset-0 overflow-y-auto">
            <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0" onclick="hideEmbedDialog()">
                <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                    <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
                </div>
                <!-- This element is to trick the browser into centering the modal contents. -->
                <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
                <div class="inline-block align-bottom bg-white text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:w-full w-section" 
                     role="dialog" aria-modal="true" aria-labelledby="modal-headline">
                    <div class="bg-white px-4 pt-1 pb-4 sm:p-2 sm:pb-4" onclick="event.stopPropagation()">
                        <div class="sm:flex sm:items-start">
                            <div class="flex w-full">
                                <div class="flex flex-col flex-grow">
                                    <label for="ModalIFrame" class="text-lg leading-2 my-2">Embed Source Code</label>
                                    <textarea id="ModalIFrame" name="ModalIFrame" onfocus="copyEmbedSource()" style="height:9.1rem" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm text-sm border-gray-300 rounded-md"></textarea>
                                    <div class="mt-2">
                                        <div id="ModalCopy" onclick="copyEmbedSource()" class="inline-block px-1 py-2 bg-white text-base font-medium text-gray-500 hover:text-gray-700 sm:text-lg cursor-pointer">
                                            Copy
                                        </div>
                                    </div>
                                </div>
                                <div class="w-50 flex flex-col">
                                    <div title="close" class="w-6 text-lg text-gray-400 hover:text-gray-700 cursor-pointer text-right w-full" onclick="hideEmbedDialog()">âœ•</div>
                                    <form onsubmit="return false">
                                        <div class="px-4 bg-white">
                                            <div class="grid grid-cols-6 gap-3">
                                                <div class="col-span-6">
                                                    <label for="ModalHeight" class="block text-sm font-medium text-gray-700">Height</label>
                                                    <input id="ModalHeight" name="ModalHeight" oninput="updateEmbedModal()" type="number" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm text-sm border-gray-300 rounded-md" min="0" oninput="validity.valid||(value='')" value="750">
                                                </div>
                                                <div class="col-span-6">
                                                    <label for="ModalTitle" class="block text-sm font-medium text-gray-700">Title</label>
                                                    <input id="ModalTitle" name="ModalTitle" oninput="updateEmbedModal()" type="text" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm text-sm border-gray-300 rounded-md">
                                                </div>
                                                <div class="col-span-6">
                                                    <label for="ModalMode" class="block text-sm font-medium text-gray-700">Mode</label>
                                                    <select id="ModalMode" name="Type" onchange="updateEmbedModal()" class="form-select mt-1 block w-full">
                                                        <option></option>
                                                        <option value="viewonly">View Only</option>
                                                        <option value="resultonly">Result Only</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div><div style="clear: both; display: block; height: 0px;"></div></div>

<div class="foot show-embed border-t-1 py-2 text-center text-gray-500" style="margin-top:12rem">
    <div>
        <a href="https://servicestack.net" title="servicestack.net" class="opacity-25 hover:opacity-100">
            <svg class="w-6 h-6 inline-block" viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'> <style> .path{} </style><g id='servicestack-svg'><path class='path' stroke='null' d='m16.564516,43.33871c16.307057,2.035887 54.629638,20.41875 60.67742,46.306452l-78.241936,0c19.859879,-1.616734 36.825605,-27.344758 17.564516,-46.306452zm6.387097,-30.33871c6.446976,7.105645 9.520766,16.74617 9.26129,26.666129c16.546573,6.726411 41.376412,24.690121 46.625807,49.979033l19.161291,0c-8.123589,-43.132863 -54.529839,-73.551412 -75.048388,-76.645162z' /></g></svg>
        </a>
        &copy; 2021 ServiceStack, Inc.
    </div>
</div>

<script>
let LOG = location.search.indexOf('log=1') >= 0 || location.origin.startsWith("https://localhost");
/** @type {JsonServiceClient} */
let client = null;
let LANGS = ['csharp','typescript','python','dart','java','kotlin','swift','vbnet','fsharp'];
let LANG_NAMES = {
    csharp:'C#',
    typescript:'TypeScript',
    python:'Python',
    dart:'Dart',
    java:'Java',
    kotlin:'Kotlin',
    swift:'Swift',
    vbnet:'VB.NET',
    fsharp:'F#',
};
let M = {
    EVENTS: {
        UrlChange: 'url:change',
        MetaLoad: 'meta:load',
        OpChange: 'op:change',
        TagChange: 'tag:change',
        LangChange: 'lang:change',
        IncludeChange: 'include:change',
        IFrameLoad: 'iframe:load',
    },
    ON:{},
    SITES: {},
    state:null,
    baseUrl: '',
    slug:'',
    scheme: 'https',
    requiresAuth: false,
    lang: '',
    meta: null,
    tag: '',
    op: null,
    args: null,
    include:'',
    errorStatus:null,
    iframeLoading:false,
    hasInit:false,
    fullscreen:localStorage.getItem('fullscreen') === 'true',
    setUrl(scheme, baseUrl) {
        if (scheme === this.scheme && baseUrl === this.baseUrl) return;

        this.scheme = scheme || 'https';
        this.baseUrl = trimEnd(baseUrl || '','/');
        if (this.baseUrl.indexOf('://') >= 0) {
            this.scheme = leftPart(this.baseUrl,'://');
            this.baseUrl = rightPart(this.baseUrl,'://');
        }
        this.slug = this.baseUrl ? urlToSlug(this.baseUrl) : null;
        if (!this.lang) {
            this.lang = localStorage.getItem('lang:active') || 'csharp';
        }
        this.reset();
        this.loadSiteMeta();
        this.syncClasses();
        this.updateHash();
        this.trigger(this.EVENTS.UrlChange);
        this.trigger(this.EVENTS.LangChange);
        return this.baseUrl;
    },
    setInclude(id) {
        localStorage.setItem('include:active',this.include=id);
        this.trigger(this.EVENTS.IncludeChange);
        this.syncClasses();
    },
    getInclude() {
        return localStorage.getItem('include:active') || 'includeAll';
    },
    setLang(lang) {
        if (lang && LANGS.indexOf(lang) === -1) {
            if (LOG) console.log(`Not a valid language: ${lang}`);
            return;
        }
        localStorage.setItem('lang:active',this.lang=lang);
        this.trigger(this.EVENTS.LangChange);
        this.updateHash();
        this.syncClasses();
    },
    getLangName() {
        return this.lang && LANG_NAMES[this.lang];
    },
    setErrorStatus(status) {
        this.errorStatus = status;
        this.syncClasses();
    },
    getOpName() {
      return this.op && this.op.request.name;  
    },
    assertMeta(method) {
        if (!this.meta) {
            if (LOG) console.log(`${method} assertMeta(): failed`);
            return null;
        }
        return this.meta;
    },
    assertOp(method) {
        let opName = this.getOpName();
        if (!this.slug || !opName) {
            if (LOG) console.log(`${method} assertOp(): Invalid state: slug:${this.slug}, op:${opName}`);
            return null;
        }
        return opName;
    },
    getFormState() {
        let opName = this.assertOp('getFormState');
        if (!opName) return;
        let opsState = this.SITES[this.slug] && this.SITES[this.slug].ops && this.SITES[this.slug].ops[this.op.request.name];
        return opsState && opsState.formState || this.getOpCache('formState');
    },
    getOpCacheKey(type) { return `${this.slug}::${this.getOpName()}::${type}`; },
    setOpCache(type,value) {
        localStorage.setItem(this.getOpCacheKey(type), JSON.stringify(value));
    },
    getOpCache(type,value) {
        let cacheKey = this.getOpCacheKey(type);
        let json = localStorage.getItem(cacheKey);
        try {
            return json ? JSON.parse(json) : null;
        } catch (e) {
            if (LOG) console.log(`ERROR getOpCache(): ${cacheKey}, removing...`, json);
            localStorage.removeItem(cacheKey);
        }
    },
    setFormState(obj,cache) {
        let opName = this.assertOp('setFormState');
        if (!opName) return;
        let ops = this.SITES[this.slug].ops || (this.SITES[this.slug].ops = {});
        let opState = ops[opName] || (ops[opName]={});
        opState.formState = obj;
        if (LOG) console.log(`setFormState(): cache:${!!cache}`, obj);
        if (cache) this.setOpCache('formState', obj);
        this.updateHash();
    },
    setHashState(state) {
        if (LOG) console.log(`setHashState():`, state);
        this.setUrl(state.scheme, state.baseUrl);
        if (state.lang) this.setLang(state.lang);
        this.state = state;
        this.restoreFromStateIfExists();
    },
    restoreFromStateIfExists() {
        if (!this.meta || !this.state || !$('#iframe')) return;
        let state = this.state;
        this.state = null;
        if (LOG) console.log(`restoreFromStateIfExists(): tag:${state.tag}, op:${state.op}`, state);
        if (state.tag)
            this.selectTag(state.tag);
        if (state.op)
            this.selectOp(state.op);
        if (state.args)
            this.setFormState(state.args);
    },
    loadSiteMeta() {
        if (!this.slug) {
            if (LOG) console.log(`loadSiteMeta(): ignoring: ${this.slug}`);
            return;
        }
        this.meta = this.SITES[this.slug];
        if (!this.SITES[this.slug]) {
            client.get(new SiteMeta({ slug:this.slug }))
                .then(r => {
                    this.meta = this.SITES[this.slug] = r.api;
                    this.trigger(this.EVENTS.MetaLoad);
                    this.restoreFromStateIfExists();
                });
        }
    },
    getOperationNames() {
        if (!this.assertMeta('getOperationNames')) return;
        return this.tag
            ? this.meta.operations.filter(x => x.tags && x.tags.indexOf(this.tag) >= 0).map(op => op.request.name)
            : this.meta.operations.map(op => op.request.name);
    },
    getUniqueTags() {
        if (!this.assertMeta('getUniqueTags')) return;
        return uniq(flatMap(x => x.tags, this.meta.operations.filter(x => x.tags)));        
    },
    selectOp(opName) {
        if (opName) {
            this.op = this.meta.operations.find(x => x.request.name === opName);
        } else {
            this.op = null;
        }
        this.syncClasses();
        this.updateHash();
        this.trigger(this.EVENTS.OpChange);
        return opName || '';
    },
    selectTag(tag) {
        if (LOG) console.log(`selectTag(): ${tag}`);
        this.selectOp(null);
        this.tag = tag;
        this.trigger(this.EVENTS.TagChange);
    },
    reset() {
        if (LOG) console.log(`reset(): ${this.slug}`);
        this.tag = '';
        this.requiresAuth = false;
        this.errorStatus = this.meta = this.op = this.args = null;
    },
    syncClasses() {
        let cls = ['m-0 font-sans bg-gray-50'];
        if (!this.baseUrl) {
            cls.push('nourl');
        } else if (this.baseUrl && this.lang) {
            cls.push('has-embed');
        }
        if (this.meta) {
            cls.push('has-meta');
        }
        if (this.lang) {
            cls.push(this.lang);
        }
        if (this.errorStatus) {
            cls.push('has-error');
        }
        if (this.op && this.op.requiresAuth) {
            cls.push('requires-auth');
        }
        if (this.fullscreen) {
            cls.push('fullscreen');
        }
        document.body.className = cls.join(' ');
    },
    getGistUrl() {
        if (!this.slug || !this.lang)
            throw new Error(`getGistUrl(): invalid state: ${this.slug}/${this.lang}`);
        return combinePaths(location.origin,this.getRelativeGistUrl());
    },
    getRelativeGistUrl() {
        if (!this.slug || !this.lang)
            throw new Error(`getRelativeGistUrl(): invalid state: ${this.slug}/${this.lang}`);
        let url = combinePaths('gists',this.slug,this.lang);
        let opName = this.assertOp('getGistUrl');
        if (opName) {
            if (this.include)
                opName = `${this.include},${opName}`;
            url = combinePaths(url, opName);
            let formState = this.getFormState();
            return formState
                ? url + getArgs(formState, this.op.request, this.meta)
                : url;
        }
        return url;
    },
    getArgsAsJsObjectLiteral() {
        let opName = this.getOpName();
        if (!opName) return '';
        let formState = this.getFormState();
        return getArgsAsJsObject(formState, this.op.request, this.meta);
    },
    getIFrameSrc() {
        let url = this.getGistUrl();
        let iframeSrc = embedUrl(url);
        if (LOG) console.log('iframeSrc',iframeSrc);
        return iframeSrc;
    },
    clearHash() {
        history.pushState("", document.title, window.location.pathname + window.location.search);
    },
    getHashState() {
        if (!this.lang) {
            return { title: this.slug, url: '#' + this.slug }
        }
        let hash = `#${this.slug}/${this.lang}`;
        let opName = this.getOpName();
        let formState = this.getFormState();
        if (opName && formState) {
            let args = getArgs(formState, this.op.request, this.meta);
            let tag = this.tag ? this.tag + '/' : '';
            let hashUrl = hash + '/' + tag + opName + args;
            return { title: `${this.slug} ${this.lang} ${opName}`, url: hashUrl };
        }
        return { title: `${this.slug} ${this.lang}`, url: hash };
    },
    toggleFullscreen() {
        this.setFullscreen(!this.fullscreen);
    },
    setFullscreen(value) {
        this.fullscreen = value;
        localStorage.setItem('fullscreen', this.fullscreen ? 'true' : 'false');
        this.syncClasses();
    },
    updateHash() {
        if (!this.hasInit) {
            if (LOG) console.log(`updateHash(): !hasInit, ignoring.`);
            return;
        }
        if (!this.baseUrl) {
            this.clearHash();
        } else {
            let hashState = this.getHashState(); 
            if (location.hash !== hashState.url) {
                if (LOG) console.log(`Updating modified hashState: ${location.hash} != ${hashState.url}`);
                history.pushState(hashState.data || null, hashState.title, hashState.url);
            } else if (LOG) console.log(`Ignoring updating existing hash: ${location.hash}`);
        }
    },
    on(evt, cb) {
        let evtHandlers = this.ON[evt] || (this.ON[evt] = []);
        evtHandlers.push(cb);
        if (LOG) console.log(`registered new ${evt} handler, total: ${evtHandlers.length}`);
    },
    trigger(evt) {
        let handlers = this.ON[evt];
        if (handlers) {
            if (LOG) console.log(`Firing ${handlers.length} ${evt} event handlers...`);
            handlers.forEach(fn => fn());
        }
    }
};

function $(sel, el) {
    return typeof sel === "string" ? (el || document).querySelector(sel) : sel || null;
}
function $$(sel, el) {
    return typeof sel === "string" 
        ? Array.prototype.slice.call((el || document).querySelectorAll(sel)) 
        : Array.isArray(sel) 
            ? sel 
            : [sel];
}
function on(sel, handlers) {
    $$(sel).forEach(e => {
        Object.keys(handlers).forEach(function (evt) {
            let fn = handlers[evt];
            if (typeof evt === 'string' && typeof fn === 'function') {
                e.addEventListener(evt, fn.bind(e));
            }
        })
    });
}

function urlError(error) {
    $("#formUrl .invalid-feedback").innerHTML = error.message;
    if (error.field)
        $(error.field).classList.add('is-invalid');
    $("#formUrl").classList.add('error');
}
function clearErrors($el) {
    $el.classList.remove('error');
    $el.querySelectorAll('.error').forEach(el => el.classList.remove('error'));
    $el.querySelectorAll('.is-invalid').forEach(el => el.classList.remove('is-invalid'));
}
function isInteger(str) {
    let n = Math.floor(Number(str));
    return n !== Infinity && String(n) === str && n >= 0;
}
function urlToSlug(url) {
    let slug = url;
    if (slug.startsWith("https://"))
        slug = slug.substring("https://".length);
    else if (slug.startsWith("http://"))
        slug = "http:" + slug.substring("http://".length);
    slug = slug.replace(/\//g, ':');
    return slug;
}
function urlFromSlug(slug) {
    let url = slug;
    let isUrl = url.startsWith("https://") || url.startsWith("http://");
    let scheme = !isUrl && (url.startsWith("http:") || url.startsWith("https:"))
        ? leftPart(url,':')
        : null;
    if (scheme != null)
        url = rightPart(url,':');

    let firstPos = url.indexOf(':');
    if (!isUrl && firstPos >= 0) {
        let isColonPos = indexOfAny(url,[':', '/', '(']);
        if (isColonPos >= 0 && url[isColonPos] === ':') {
            let atPort = rightPart(url,':');
            if (atPort.length > 0) {
                let delim1Pos = atPort.indexOf(':');
                let delim2Pos = atPort.indexOf('/');
                let endPos = delim1Pos >= 0 && delim2Pos >= 0
                    ? Math.min(delim1Pos, delim2Pos)
                    : Math.max(delim1Pos, delim2Pos);
                let testPort = endPos >= 0
                    ? atPort.substring(0,endPos)
                    : atPort.substring(0,atPort.length - 1);
                url = isInteger(testPort)
                    ? leftPart(url,':') + ':' + unSlash(atPort)
                    : leftPart(url,':') + '/' + unSlash(atPort);
            } else {
                url = leftPart(url,':') + '/' + unSlash(atPort);
            }
        }
    }
    url = decodeURIComponent(url);
    if (!isUrl) {
        url = scheme != null
            ? scheme + "://" + url
            : "https://" + url;
    }
    return url;
}
function unSlash(urlComponent) {
    // don't replace ':' after '('...)
    if (urlComponent.indexOf('(') >= 0) {
        let target = leftPart(urlComponent,'(');
        let suffix = rightPart(urlComponent,'(');
        return target.replace(/:/g, '/') + '(' + suffix;
    }
    return urlComponent.replace(/:/g, '/');
}

function parsePath(path) {
    let argString = path.indexOf('(') >= 0 ? '{' + decodeURIComponent(lastRightPart(path.substring(0,path.length-1),'(')) + '}' : null;
    if (argString) path = lastLeftPart(path,'(');
    let args = argString ? toStringValues(jsvParse(argString)) : null;
    let segments = path.split('/');
    let url = urlFromSlug(segments[0]);
    let parts = url.split('://');
    let hasScheme = parts.length > 1;
    let baseUrl = !hasScheme
        ? parts[0]
        : parts[1];
    let scheme = hasScheme ? parts[0] : this.scheme;
    if (scheme !== 'http' && scheme !== 'https') {
        return urlError({ message:'Invalid Scheme', field:'#scheme' });
    }
    let lang = segments.length > 1 ? segments[1] : null;
    let op = segments.length === 4
        ? segments[3]
        : segments.length === 3
            ? segments[2]
            : null;
    let tag = segments.length === 4 ? segments[2] : null;
    return  { scheme:scheme, baseUrl:baseUrl, lang:lang, tag:tag, op:op, argString:argString, args:args, segments:segments };
}

function toStringValues(obj) {
    if (!obj) return null;
    let to = {};
    Object.keys(obj).forEach(k => {
       let val = obj[k];
       if (!val) return;
       if (Array.isArray(val)) {
           let sb = new StringBuffer();
           val.forEach(x => {
               if (sb.getLength() > 0)
                   sb.append(',');
               sb.append(x);
           });
           to[k] = sb.toString();
       } else if (typeof val === "object") {
           to[k] = JSON.stringify(val);
       } else {
           to[k] = `${val}`;
       }
    });
    return to;
}

function handleHash(path) {
    if (!path) return;
    let r = parsePath(path);
    M.setHashState(r);
    $('#baseUrl').value = M.baseUrl;
    $('#scheme').value = M.scheme;
}

function activateLang() {
    $$('.lang').forEach(el => { 
        if (el.getAttribute('data-lang') === M.lang) 
            el.classList.add('active');
        else
            el.classList.remove('active');
    });
    $('#selLang').value = M.lang;
}
function activateTag() {
    $$('.tag').forEach(el => {
        if (el.getAttribute('data-tag') === M.tag)
            el.classList.add('active');
        else
            el.classList.remove('active');
    });
}

let opsAwesomplete = null; 
function updateLang() {
    let lang = M.lang;
    if (LOG) console.log(`updateLang(): lang:${lang}, tag:${M.tag}, meta:${!!M.meta}`);
    if (!lang || !M.meta) return;

    let $form = $('#apiForm form');
    if (LOG) console.log('$form',$form);
    if ($form) {
        applyForm($form);
        return;
    }

    clearErrorSummary();
    setLoading('#embed-loading'); //hides on onIFrameLoad()
    client.get(new GistRef({ slug:M.slug, lang:lang }))
        .then(r => {
            showEmbed(r);
        });

    let meta = M.meta;
    let sortFn = (x,y) => x > y ? 1 : -1;
    let ops = M.getOperationNames();
    //if (LOG) console.log(`selectLang ops *`, ops);
    if (opsAwesomplete) {
        opsAwesomplete.destroy();
        opsAwesomplete = null;
    }
    opsAwesomplete = new Awesomplete('#txtRequest', { list:ops, sort:sortFn });
    let tagNames = M.getUniqueTags();
    let sb = new StringBuffer();
    tagNames.forEach(tag =>
        sb.append(`<div class="tag${tag === M.tag ? ' active' : ''} text-xs inline-flex items-center font-bold leading-4 uppercase px-3 py-1 mr-1 bg-blue-100 text-blue-500 rounded-full cursor-pointer" 
                        data-tag="${tag}" data-click="selectTag">${tag}</div>`));
    $("#tags").innerHTML = sb.toString();

    updateDownload();
}

function setLoading(sel) {
    if (LOG) console.log(`setLoading(${sel})`);
    M.iframeLoading = true;
    setTimeout(() => {
        if (M.iframeLoading)
            $$(sel).forEach(el => el.parentElement.classList.add('loading'));
    }, 100);
}
function endLoading(sel) {
    if (LOG) console.log(`endLoading(${sel})`);
    M.iframeLoading = false;
    $$(sel).forEach(el => el.parentElement.classList.remove('loading'));
}

let GISTCAFE_URL=location.origin.indexOf('apps.servicestack.net') >= 0 ? 'https://gist.cafe' : 'https://localhost:5001';
function embedUrl(url) {
    return `${GISTCAFE_URL}/embed?gist=` + encodeURIComponent(url);
}
function archiveUrl(url,filename) {
    return `${GISTCAFE_URL}/archive?url=` + encodeURIComponent(url) + '&name=' + filename;
}

function showEmbed(r) {
    let $embed = $('#embed');
    let embedSrc = embedUrl(r.id);
    $embed.innerHTML = `
        <span data-click="toggleFullscreen" 
              class="absolute hide-loading inline-block cursor-pointer" style="background:#f7f7f7; margin:.7rem 0 0 .25rem;z-index: 10">
            <svg class="w-5.5 h-5.5 hide-fullscreen" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" height="24" viewBox="0 0 24 24" width="24">
                <title>Maximize</title>
                <g><path d="M0,0h24v24H0V0z" fill="none"/></g>
                <g><path fill="#666" d="M6,16h12V8H6V16z M8,10h8v4H8V10z M4,15H2v3c0,1.1,0.9,2,2,2h3v-2H4V15z M4,6h3V4H4C2.9,4,2,4.9,2,6v3h2V6z M20,4h-3v2h3v3 h2V6C22,4.9,21.1,4,20,4z M20,18h-3v2h3c1.1,0,2-0.9,2-2v-3h-2V18z"/></g>
            </svg>
            <svg class="w-5.5 h-5.5 show-fullscreen" xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24">
                <title>Minimize</title>
                <path d="M0 0h24v24H0V0z" fill="none"/><path fill="#666" d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/>
            </svg>
        </span>
        <div id="lnkEmbed" class="absolute hide-loading inline-block hide-fullscreen text-gray-500 cursor-pointer" title="Embed Source Code" data-click="showEmbedDialog">
            <svg class="inline-block w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path></svg>
            <span class="inline-block">embed</span>
        </div>
        <iframe id="iframe" class="h-embed w-full" src="${embedSrc}"></iframe>`;
    updateEmbedModal();
    on('#iframe', {
        load: () => M.trigger(M.EVENTS.IFrameLoad)
    })
}
M.on(M.EVENTS.IFrameLoad, onIFrameLoad);
function onIFrameLoad() {
    if (LOG) console.log(`onIFrameLoad()`);
    M.restoreFromStateIfExists();
    endLoading('#embed-loading');
}

function copyEmbedSource(){
    let $txt = $('#ModalIFrame');
    $txt.select();
    document.execCommand("copy");
    let $btn = $('#ModalCopy');
    $btn.innerHTML = "Copied!";
    setTimeout(() => $btn.innerHTML = "Copy", 3000);
}

function updateEmbedModal() {
    if (!M.slug || !M.lang) return;
    
    let url = M.getIFrameSrc();
    
    let height = $("#ModalHeight").value || '750';
    let opt = {};

    //&title=Test&show=MyApp.csproj&mode=viewonly
    let title = $('#ModalTitle').value;
    if (title) opt.title = title;
    let mode = $('#ModalMode').value;
    if (mode) opt.mode = mode;
    url = appendQueryString(url,opt);

    $('#ModalIFrame').innerText = `<iframe src="${url}" frameborder="0" style="height:${height}px;width:100%;border:1px solid #ddd"></iframe>`;
}

function selectUrl() {
    let $scheme = $('#scheme'), $baseUrl = $('#baseUrl');
    M.setUrl($scheme.value, $baseUrl.value);
    $scheme.value = M.scheme;
    $baseUrl.value = M.baseUrl;
}

M.on(M.EVENTS.UrlChange, onUrlChange);
function onUrlChange() {
    $('#txtRequest').value = '';
    clearForm();
}

M.on(M.EVENTS.MetaLoad, onMetaLoad);
function onMetaLoad() {
    updateLang();
}

on('#formUrl', { submit: e => { e.preventDefault(); selectUrl(); } });
on('#scheme,#baseUrl', { change: selectUrl });
on('#btn-clear div', {
    click: function (e) {
        let $scheme = $('#scheme'), $baseUrl = $('#baseUrl');
        M.setUrl($scheme.value, '');
        $scheme.value = M.scheme;
        $baseUrl.value = M.baseUrl;
        M.setFullscreen(false);
    }
})

function setError(status, defaultTitle) {
    let $error = $('#error-summary');
    $error.querySelector('b').innerHTML = status.errorCode || defaultTitle || 'Error';
    let pos = status.message ? status.message.indexOf('(Parameter ') : -1;
    $error.querySelector('p').innerHTML = pos >= 0 ? status.message.substring(0,pos) : status.message;
    M.setErrorStatus(status);
}
function clearErrorSummary() { 
    let $error = $('#error-summary');
    $error.querySelector('b').innerHTML = '';
    $error.querySelector('p').innerHTML = '';
    M.setErrorStatus(null);
}
function clearForm() {
    clearErrorSummary();
    $('#apiForm').innerHTML = '';
    updateDownload();
}

window.onhashchange = function () {
    handleHash(location.hash.substring(1));
}

function findType(meta, typeName, namespace) {
    let type = meta.types.find(x => x.name === typeName && (!namespace || x.namespace === namespace))
        || meta.operations.map(x => x.request).find(x => x.name === typeName && (!namespace || x.namespace === namespace))
        || meta.operations.map(x => x.response).filter(x => x != null)
            .find(x => x.name === typeName && (!namespace || x.namespace === namespace));
    return type;
}
function trimPrefixes(str,c) {
    return str.replace(new RegExp(`^${c}+`,'g'),'');
}
let NumericTypes = ['Byte','SByte','Int16','Int32','Int64','UInt16','UInt32','UInt64','Single','Double','Decimal'];
function isNumeric(type) { return NumericTypes.indexOf(type) >= 0; }

let BuiltInTypes = ['String','Boolean','DateTime','DateTimeOffset','TimeSpan','Char','Guid'].concat(NumericTypes);
let IgnoreTypes = ['KeyValuePair`2'];

function typeInfo(meta,prop) {
    let type = prop.type === "Nullable`1"
        ? prop.genericArgs[0]
        : prop.type;
    let isArray = type.endsWith("[]");
    let elementType = isArray
        ? leftPart(type,'[')
        : null;
    let enumType = prop.isEnum === true
        ? findType(meta, prop.type, prop.typeNamespace)
        : null;
    let collectionType = prop.typeNamespace === "System.Collections.Generic"
        ? `${trimPrefixes(leftPart(prop.type,'`'),'I')}<${prop.genericArgs.join(',')}>`
        : null;
    if (collectionType) {
        elementType = prop.genericArgs.length === 1 
            ? prop.genericArgs[0]
            : prop.genericArgs.length === 2
                ? `KeyValuePair<${prop.genericArgs.join(',')}>`
                : null;
    }
    let metaType = findType(meta, type, prop.typeNamespace);
    let info = {
        meta: metaType,
        type: type,
        namespace: (metaType && metaType.namespace) || prop.typeNamespace,
        isArray: isArray,
        elementType: elementType,
        isEnum: enumType != null,
        enumType: enumType,
        collectionType: collectionType,
        isDictionary: collectionType != null && collectionType.indexOf('Dictionary') >= 0,
        isString: type === 'String',
        isChar: type === 'Char',
        isGuid: type === 'Guid',
        isNumeric: isNumeric(type),
        isDateTime: type === 'DateTime' || type === 'DateTimeOffset',
        isTimeSpan: type === 'TimeSpan',
        isBoolean: type === 'Boolean',
        isGeneric: type.indexOf('`') >= 0,
        isBuiltIn: elementType || BuiltInTypes.indexOf(type) >= 0,
    };
    info.isClass = metaType != null || (!info.isNumeric && !BuiltInTypes.indexOf(type));
    info.ignore = (IgnoreTypes.indexOf(type) >= 0 || info.isDictionary || BuiltInTypes.indexOf(type) === -1)
        && !(info.elementType != null && BuiltInTypes.indexOf(info.elementType) >= 0) && !info.isEnum;
    
    //if (LOG) console.log(`typeInfo(${prop.type})`, info);
    return info;
}

function typeProperties(meta,type) {
    let to = [];
    if (type == null)
        return to;
    
    do {
        if (type.properties) {
            type.properties.forEach(x => {
                to.push(x);
            });
        }
        type = type.inherits
            ? findType(meta, type.inherits.name, type.inherits.namespace)
            : null;
    } while (type != null);
    
    return to;
}
let PosIntFields = ['Skip','Take'];
let MultiPropFields = ['OrderBy','OrderByDesc','Fields'];
let NarrowFields = ['Skip','Take','OrderBy','OrderByDesc'];
function createInput(prop,info,meta) {
    let attrs = {
        id:prop.name,
        name:prop.name,
        type:'text',
        'class':'mt-1',
        autocomplete:prop.name
    };
    if (info.elementType && isNumeric(info.elementType)) {
        attrs.title = "comma-delimited list of numbers";
        attrs.pattern = "[0-9.,]*";
        attrs.onblur = "this.reportValidity()";
    }
    else if (info.isNumeric) {
        attrs.type = 'number';
        let posIntOnly = PosIntFields.indexOf(prop.name) >= 0 || info.type.startsWith('U');
        if (posIntOnly) {
            attrs.min = "0";
            attrs.oninput = "validity.valid||(value='')";
        }
    }
    else if (info.isDateTime) {
        attrs.type = 'datetime-local';
    }
    else if (info.isTimeSpan) {
        attrs.pattern = "^((((?:-?0*\\d+\\.)?(?:0*)(?:2[0-3]|1[0-9]|[0-9]))(?::0*([0-5]?[0-9]))?(?::0*((?:[0-5]?[0-9])(?:\\.\\d{0,7})?)))|(\\d+))?$";
        attrs.title = "valid TimeSpan format: (D.)HH:MM:SS(.fff)";
        attrs.onblur = "this.reportValidity()";
    }
    else if (info.isChar) {
        attrs.maxlength = 1;
    }
    else if (info.isGuid) {
        attrs.pattern = "^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$";
        attrs.title = "Valid UUID format";
        attrs.onblur = "this.value = toUUID(this.value); this.reportValidity()";
    } 
    else if (info.isEnum) {
        let E = info.enumType;
        let sb = new StringBuffer();
        for (let i=0; i<E.enumNames.length; i++) {
            let value = E.enumValues
                ? E.enumValues[i]
                : E.enumNames[i];
            let desc = E.enumDescriptions
                ? E.enumDescriptions[i]
                : E.enumNames[i];
            sb.append(`<option value="${value}">${desc}</option>`);
        }
        return `<select id="${prop.name}" name="${prop.name}" class="form-select mt-1"><option></option>${sb.toString()}</select>`;
    }
    return `<input ${htmlAttrs(attrs)}>`;
}
function createControl(prop,info,meta,opt) {
    if (info.isBoolean) {
        return `<fieldset class="col-span-6">
        <div class="mt-4 space-y-4">
          <div class="flex items-start">
            <div class="flex items-center h-5">
              <input id="${prop.name}" name="${prop.name}" type="checkbox" value="true" class="">
            </div>
            <div class="ml-3 text-sm">
              <label for="${prop.name}" class="font-medium text-gray-700">${humanize(prop.name)}</label>
            </div>
          </div>
        </div>
        </fieldset>`;
    }
    return `<div class="${opt.colClass}">
        <label for="${prop.name}" class="block text-sm font-medium text-gray-700">${humanize(prop.name)}</label>
        ${createInput(prop,info,meta)}
    </div>`;
}

function isAutoQuery(request) {
    return request.inherits && request.inherits.name.startsWith('Query');
}

// used in guid onblur
function toUUID(s) {
    if (!s) return s;
    if (s.length === 32) {
        return s.substring(0,8) + '-' + s.substring(8,12) + '-' + s.substring(12,16) + '-' + s.substring(16,20) + '-' + s.substring(20);
    }
    return s;
}

function createForm(request, meta) {
    let aqRequest = isAutoQuery(request);
    let formCls = aqRequest || true ? '' : 'overflow-hidden sm:rounded-md'; //don't clip popups

    let sb = new StringBuffer(
        `<form onsubmit="return applyForm(this,true)">
            <div class="shadow ${formCls}">
              <div class="px-4 py-5 bg-white sm:p-6">
                <div class="grid grid-cols-6 gap-3">`);
    
    let props = typeProperties(meta,request);
    props.forEach(prop => {
        let info = typeInfo(meta,prop);
        if (info.ignore) return;
        let opt = {
            colClass: info.isNumeric || info.isDateTime || info.isTimeSpan || info.isChar ? 'col-span-3' : 'col-span-6'
        };
        if (aqRequest) {
            if (prop.name === 'Include')
                return;
            if (prop.name === 'Skip')
                sb.append('<hr class="col-span-6 mt-2">');             
            if (NarrowFields.indexOf(prop.name) >= 0)
                opt.colClass = 'col-span-3';
        }
        sb.append(createControl(prop,info,meta,opt));
    });
    sb.append(`</div>
      </div>`);
    
    sb.append(`<div class="px-4 py-3 bg-gray-50 text-right sm:px-6">
                <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                  Update
                </button>
            </div>
        </div>
    </form>`)
    return sb.toString();
}

function applyForm(form,cache) {
    updateDownload();    
    if (!form) return;
    let opName = $('#txtRequest').value;
    if (!opName) return false;
    let obj = serializeToObject(form);
    M.setFormState(obj,cache);
    let $iframe = $('#iframe');
    if ($iframe) {
        let iframeSrc = M.getIFrameSrc();
        setLoading('#embed-loading');
        $iframe.src = iframeSrc;
    } else if (LOG) console.log(`WARN applyForm(): #iframe not exists`);
    updateEmbedModal();
    return false;
}
function getArgsAsJsObject(obj, request, meta) {
    if (obj == null || Object.keys(obj).length === 0) return '';
    let args = new StringBuffer();
    let props = typeProperties(meta,request);
    props.forEach(prop => {
        let value = obj[prop.name];
        if (!value) return;
        value = trimEnd(value.trim(),',');
        let info = typeInfo(meta,prop);
        if (args.getLength() > 0)
            args.append(',');
        args.append(prop.name);
        args.append(':');
        if (info.elementType)
            args.append(`[${value}]`);
        else if (info.isNumeric || info.isBoolean)
            args.append(value);
        else
            args.append(JSON.stringify(value));
    });
    let argsBody = args.toString();
    return argsBody ? '{' + args.toString().replace(/"/g,"'") + '}' : '';
}
function getArgs(obj, request, meta) {
    let args = new StringBuffer();
    let props = typeProperties(meta,request);
    props.forEach(prop => {
        let value = obj[prop.name];
        if (!value) return;
        value = trimEnd(value.trim(),',');
        let info = typeInfo(meta,prop);
        if (args.getLength() > 0)
            args.append(',');
        args.append(prop.name);
        args.append(':');
        if (info.elementType)
            args.append(`[${value}]`);
        else
            args.append(JSV.stringify(value));
    });
    return '(' + args.toString() + ')';
}

function updateDownload() {
    let $includeDtos = $('#includeDtos'), $lblProject = $('#lblProject'), $zip = $('#zip'), $notebook = $('#notebook'),
        $mixLabel = $('#mix label'), $invokeLabel = $('#invoke label'), $jupyterLabel = $('#jupyter label');
    if (!M.slug || !M.lang || !M.meta) {
        $includeDtos.innerHTML = $lblProject.innerHTML = $zip.href= '';
        return;
    }
    
    let dtoOptions = [{ id:'includeAll', label: 'All', value:'*' }];
    let $selectedTag = $('#tags .active');
    let tag = $selectedTag && $selectedTag.getAttribute('data-tag');
    if ($selectedTag) {
        dtoOptions.push({ id:'includeTag', label: `Only ${tag} DTOs`, value: '{' + tag + '}' });
    }
    let $txtRequest = $('#txtRequest');
    if ($txtRequest.value) {
        dtoOptions.push({ id:'includeRequest', label: `Only ${$txtRequest.value} DTOs`, value: '' });
    }
    
    let selectedInclude = M.getInclude();
    let selectedOption = dtoOptions.find(x => x.value === selectedInclude) || dtoOptions[dtoOptions.length-1];
    selectedOption.checked = true;

    let sb = new StringBuffer();
    dtoOptions.forEach(x => {
        let checked = x.checked === true ? ' checked' : '';
        sb.append(`<div class="flex items-center">
            <input id="${x.id}" name="include" value="${x.value}" ${checked} type="radio" onchange="M.setInclude('${x.value}')" 
                   class="">
                <label for="${x.id}" class="ml-3 block text-sm font-medium text-gray-700">${x.label}</label>
        </div>`);
    });
    let includeHtml = `<fieldset>
          <div>
            <legend class="uppercase text-base font-medium text-gray-900">Include DTOs</legend>
          </div>
        <div class="mt-4 space-y-4">${sb.toString()}</div>
    </fieldset>`;
    
    let projectName = $('#txtProjectName').value || 'MyApp';
    $includeDtos.innerHTML = includeHtml;
    $lblProject.innerHTML = `${projectName}.zip`;
    $zip.href = archiveUrl(M.getGistUrl(), projectName);
    
    let name = projectName !== 'MyApp' ? ` -name ${projectName}` : '';
    let hasOp = !!M.getOpName();
    $('#mix').style.display = $('#invoke').style.display = hasOp ? 'block' : 'none';
    
    function ext(name,ext) {
        return name.endsWith(ext) ? name : name + ext;
    }
    
    let supportsJupyter = ['python','csharp','fsharp'].indexOf(M.lang) >= 0;
    $("#notebook span").innerHTML = `${M.getLangName()} Notebook`;
    $('#jupyter').style.display = $notebook.style.display = supportsJupyter ? 'block' : 'none';
    if (hasOp) {
        $mixLabel.title = $mixLabel.innerHTML = `x mix -preserve${name} ${encodeURI(M.getGistUrl())}`;
        let argsBody = M.getArgsAsJsObjectLiteral();
        let quotedArgsBody = argsBody ? ' "' + argsBody + '"' : '';
        $invokeLabel.title = $invokeLabel.innerHTML = `x send ${M.scheme}://${M.baseUrl} ${M.getOpName()}${quotedArgsBody}`;

        if (supportsJupyter) {
            let include = selectedOption.value
                ? ` -include "${selectedOption.value}"`
                : '';
            $jupyterLabel.title = $jupyterLabel.innerHTML = 
                `x jupyter-${M.lang} ${M.scheme}://${M.baseUrl} ${M.getOpName()}${quotedArgsBody}${include}`;

            let args = argsBody ? encodeURIComponent(argsBody) : '';
            let name = projectName === 'MyApp' ? '' : projectName;
            $notebook.href = `/json/reply/CreateNotebook?Lang=${M.lang}&Slug=${M.slug}&IncludeTypes=${selectedOption.value}&Request=${M.getOpName()}&Args=${args}&Name=${name}`;
            gapi.savetodrive.render('savetodrive-div', {
                src: $notebook.href,
                filename: ext(name || `${M.slug}${tag ? '-' + tag : ''}-${M.getOpName()}`,'.ipynb'),
                sitename: 'apps.servicestack.net'
            });
        }
    } else {
        if (supportsJupyter) {
            let include = selectedOption.value && selectedOption.value !== '*'
                ? ` -include "${selectedOption.value}"`
                : '';
            $jupyterLabel.title = $jupyterLabel.innerHTML = `x jupyter-${M.lang} ${M.scheme}://${M.baseUrl}${include}`;
            $notebook.href = `/json/reply/CreateNotebook?Lang=${M.lang}&Slug=${M.slug}&IncludeTypes=${selectedOption.value}&Name=${projectName === 'MyApp' ? '' : projectName}`;
            gapi.savetodrive.render('savetodrive-div', {
                src: $notebook.href,
                filename: ext(name || `${M.slug}${tag ? '-' + tag : ''}`,'.ipynb'),
                sitename: 'apps.servicestack.net'
            });
        }
    }
    if (LOG) console.log(`updateDownload(): ${M.getGistUrl()}`);
}

function isAlphaNumeric(c) {
    return c >= 65 && c <= 90 || c >= 97 && c <= 122 || c >= 48 && c <= 57 || c === 95; //A-Za-z0-9_    
}

let awesompleteInstances = [];
function clearAwesompleteInstances() {
    if (awesompleteInstances.length > 0) {
        awesompleteInstances.forEach(x => x.destroy());
        awesompleteInstances = [];
    }
}

M.on(M.EVENTS.OpChange, onOpChange);
function onOpChange() {
    let $txtRequest = $('#txtRequest'); 
    if (!M.op) {
        $txtRequest.value = '';
        clearForm();
        return;
    }

    $txtRequest.value = M.getOpName();
    clearAwesompleteInstances();

    let meta = M.meta, op = M.op;
    let $apiForm = $('#apiForm');
    $apiForm.innerHTML = createForm(op.request, meta);

    populateForm(M.getFormState());
    
    if (isAutoQuery(op.request)) {
        let targetName = op.request.inherits.genericArgs[0];
        let target = findType(meta, targetName);
        if (target) {
            let targetPropNames = typeProperties(meta, target).map(x => x.name);
            let props = typeProperties(meta,op.request).filter(prop => MultiPropFields.indexOf(prop.name) >= 0);
            let cache = {};
            props.forEach(prop => {
                let id = prop.name;
                let $input = $(`#${id}`);
                let instance = new Awesomplete($input, {
                    list: targetPropNames,
                    filter: function(text, input) {
                        //console.log('filter', text, input, 1, input.indexOf(text.value + ','))
                        if (input.indexOf(text.value + ',') >= 0)
                            return false;
                        return Awesomplete.FILTER_CONTAINS(text, input.match(/[^,]*$/)[0]);
                    },
                    item: function(text, input) {
                        return Awesomplete.ITEM(text, input.match(/[^,]*$/)[0]);
                    },
                    replace: function(text) {
                        let before = this.input.value.match(/^.+,\s*|/)[0];
                        this.input.value = before + text + ", ";
                    }
                });
                on($input, {
                    mousedown: function () {
                        let instance = awesompleteInstances.find(x => x.input === this);
                        if (instance) {
                            instance.evaluate();
                            instance.open();
                        }
                    }
                })
                awesompleteInstances.push(instance);
                if (LOG) console.log('awesompleteInstances', awesompleteInstances)
            });
        } else if (LOG) console.error(`Could not find table: ${targetName}`);
    }

    let $input = $$('input,select,textarea',$apiForm)[0];
    if ($input) $input.focus();

    applyForm($('#apiForm form'));
}

function populateForm(formState) {
    if (LOG) console.log(`populateForm():`, formState);
    if (formState) {
        let keys = Object.keys(formState);
        keys.forEach(k => {
            let val = formState[k];
            if (!val) return;
            let $el = $(`#${k}`);
            if (!$el) {
                if (LOG) console.log(`Could not find element for #${k}`);
                return;
            }
            $el.value = val;
        });
    }
}

M.on(M.EVENTS.LangChange, onLangChange);
function onLangChange() {
    activateLang();
    updateLang();
}

M.on(M.EVENTS.TagChange, onTagChange);
function onTagChange() {
    let ops = M.getOperationNames();
    if (LOG) console.log(`onTagChange(): ops:${M.tag ?? '*'}`, ops);
    activateTag();
    opsAwesomplete.list = ops || [];
    opsAwesomplete.input.focus();
    onOpChange();
    updateDownload();
}

M.on(M.EVENTS.IncludeChange, onIncludeChange);
function onIncludeChange() {
    onOpChange();
    updateDownload();
}

function copy (e) {
    let $el = document.createElement("input");
    let $parent = e.parentElement;
    let $lbl = $parent.firstElementChild;
    $el.setAttribute("value", $lbl.innerText);
    document.body.appendChild($el);
    $el.select();
    document.execCommand("copy");
    document.body.removeChild($el);
    $parent.classList.add('copied');
}

function getOS() {
    let v = navigator.appVersion.toLowerCase();
    if (v.indexOf('win')>=0) return 'win';
    if (v.indexOf("mac")>=0) return 'mac';
    if (v.indexOf("linux")>=0 || v.indexOf("x11")>=0) return "linux";
    return 'win';
}

function selectTab(tab,tabs) {
    $$('[data-tab]',tabs).forEach(el => {
        if (el.getAttribute('data-tab') === tab) {
            if (!el.classList.contains('active')) el.classList.add('active');
        } else {
            el.classList.remove('active');
        }
    });
    $$('.tab-pane',tabs).forEach(el => {
        if (el.id === tab) {
            if (!el.classList.contains('active')) el.classList.add('active');
        } else {
            el.classList.remove('active');
        }
    });
}
function showEmbedDialog() {
    $('#embed-modal').classList.add('active');
}
function hideEmbedDialog() {
    $('#embed-modal').classList.remove('active');
}

function init() {
    let { bindHandlers, leftPart, rightPart, JsonServiceClient, GistRef, SiteMeta, humanize, enc, StringBuffer, JSV, indexOfAny, 
          htmlAttrs, serializeToObject, combinePaths, trimEnd, uniq, flatMap, lastLeftPart, lastRightPart, appendQueryString } = exports;
    Object.assign(window, { leftPart, rightPart, JsonServiceClient, GistRef, SiteMeta, humanize, enc, StringBuffer, indexOfAny, 
        JSV, htmlAttrs, serializeToObject, combinePaths, trimEnd, uniq, flatMap, lastLeftPart, lastRightPart, appendQueryString });
    client = new JsonServiceClient();
    client.exceptionFilter = (res,err) => {
        setError(err.responseStatus || err, res.statusText || res.status);
        console.log(err);
    };

    selectTab(getOS(), $('#setup'));
    if (location.hash) {
        handleHash(location.hash.substring(1));
    }
    bindHandlers({
        selectLang: function (e) {
            let lang = !this.classList.contains('active') 
                ? this.getAttribute('data-lang') 
                : null;
            M.setLang(lang);
        },
        selectTag: function () {
            this.classList.toggle('active');
            let tag = this.classList.contains('active') 
                ? this.getAttribute('data-tag')
                : null;
            M.selectTag(tag);
        },
        toggleFullscreen: M.toggleFullscreen.bind(M),
        openWith: function () {
            let use = this.getAttribute('data-use');
            let name = $('#txtProjectName').value || 'MyApp';
            let url = `gist://${rightPart(location.origin, '://')}/${rightPart(M.getRelativeGistUrl(),'://')}?use=${use}&name=${name}`;
            if (LOG) console.log(`Open with... ${url}`);
            location.href = url;
        },
        selectTab: function () {
            selectTab(this.getAttribute('data-tab'), this.closest('tabs'));
        },
        showEmbedDialog: showEmbedDialog,
        hideEmbedDialog: hideEmbedDialog
    });
    on('#txtRequest', {
        'awesomplete-select': function (evt) {
            let opName = evt.text.value;
            let $txtRequest = $('#txtRequest');
            if (LOG) console.log('awesomplete-select', opName, $txtRequest.value);
            $txtRequest.value = M.selectOp(opName);
        },
        blur: function () {
            setTimeout(function () {
                let $txtRequest = $('#txtRequest');
                let opName = $txtRequest.value;
                $txtRequest.value = M.selectOp(opName);
                if (LOG) console.log(`on/setTimeout/blur(): ${M.getOpName()}`);
            }, 0)
        }
    });
    on('#selLang', {
        change: function () {
            M.setLang(this.value);
        }
    });
    M.hasInit = true;
}
document.addEventListener('DOMContentLoaded',init);

function jsvParse(jsv) {
    if (!jsv) return jsv;
    if (jsv[0] === '{')
        return jsvParseObject(jsv);
    else if (jsv[0] === '[')
        return jsvParseArray(jsv);
    else
        return jsvParseString(jsv);
}
function jsvParseObject(s) {
    if (s[0] !== '{')
        throw "Type definitions should start with a '{', got string starting with: "
        + s.substr(0, s.length < 50 ? s.length : 50);
    let k, obj = {};
    if (s === '{}') return null;
    for (let ref={i:1}, len = s.length; ref.i < len; ref.i++) {
        k = jsvEatMapKey(s, ref);
        ref.i++;
        let v = jsvEatMapValue(s, ref);
        obj[k]= jsvParse(v);
    }
    return obj;
}
function jsvParseString(s) {
    return !s || s[0] !== '"' ? s : s.substr(1, s.length - 2).replace(/""/g, '"');
}
function jsvEatMapKey(s, ref) {
    let pos = ref.i;
    while (s[++ref.i] !== ':' && ref.i < s.length) { }
    return s.substr(pos, ref.i - pos);
}
function jsvEatMapValue(s, ref) {
    let tokPos = ref.i;
    let sLen = s.length;
    if (ref.i === sLen) return null;
    let c = s[ref.i];
    if (c === ',' || c === '}')
        return null;
    let inQ = false;
    if (c === '[') { //Is List, i.e. [...]
        let endsToEat = 1;
        while (++ref.i < sLen && endsToEat > 0) {
            c = s[ref.i];
            if (c === '"')
                inQ = !inQ;
            if (inQ)
                continue;
            if (c === '[')
                endsToEat++;
            if (c === ']')
                endsToEat--;
        }
        return s.substr(tokPos, ref.i - tokPos);
    }
    if (c === '{') { //Is Map, i.e. {...}
        let endsToEat = 1;
        while (++ref.i < sLen && endsToEat > 0) {
            c = s[ref.i];
            if (c === '"')
                inQ = !inQ;
            if (inQ)
                continue;
            if (c === '{')
                endsToEat++;
            if (c === '}')
                endsToEat--;
        }
        return s.substr(tokPos, ref.i - tokPos);
    }
    if (c === '"') { //Is Within Quotes, i.e. "..."
        while (++ref.i < sLen) {
            c = s[ref.i];
            if (c !== '"') continue;
            let isQuote = ref.i + 1 < sLen && s[ref.i + 1] === '"';
            ref.i++; //skip quote
            if (!isQuote) break;
        }
        return s.substr(tokPos, ref.i - tokPos);
    }
    while (++ref.i < sLen) { //Is Value
        c = s[ref.i];
        if (c === ',' || c === '}') break;
    }
    return s.substr(tokPos, ref.i - tokPos);
}
function jsvParseArray(str) {
    let to = [], s = jsvStripList(str);
    if (!s) return to;
    if (s[0] === '{') {
        let ref = {i:0};
        do {
            let v = jsvEatMapValue(s, ref);
            to.push(jsvParse(v));
        } while (++ref.i < s.length);
    } else {
        for (let ref={i:0}; ref.i < s.length; ref.i++) {
            let v = jsvEatUntil(s, ref, ',');
            to.push(jsvParse(v));
        }
    }
    return to;
}
function jsvStripList(s) {
    if (!s) return null;
    return s[0] === '[' ? s.substr(1, s.length - 2) : s;
}
function jsvEatUntil(s, ref, findChar) {
    let tokPos = ref.i;
    let sLen = s.length;
    if (s[tokPos] !== '"') {
        ref.i = s.indexOf(findChar, tokPos);
        if (ref.i === -1) ref.i = sLen;
        return s.substr(tokPos, ref.i - tokPos);
    }
    while (++ref.i < sLen) {
        if (s[ref.i] === '"') {
            if (ref.i + 1 >= sLen)
                return s.substr(tokPos, ++ref.i - tokPos);
            if (s[ref.i + 1] === '"')
                ref.i++;
            else if (s[ref.i + 1] === findChar)
                return s.substr(tokPos, ++ref.i - tokPos);
        }
    }
    throw "Could not find ending quote";
}

</script>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-RFJMWNBD9F"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-RFJMWNBD9F');</script>

<link rel="stylesheet" href="/assets/lib/awesomplete.css">
<script src="/assets/lib/awesomplete.js"></script>

</body>
</html>